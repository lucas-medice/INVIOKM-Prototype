<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- ... (cabeçalho mantido igual) ... -->
    <style>
        .modal-overlay, .form-group, .form-buttons, #btnSaida, #btnChegada {
            display: none !important;
        }
        .tabela tbody tr {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .tabela tbody tr:hover {
            background-color: #e0e0e0 !important;
        }
        .tabela tbody tr.selecionada {
            background-color: #c8e6c9 !important;
            box-shadow: inset 0 0 0 2px #4CAF50;
        }
    </style>
</head>

<body>
    <!-- ... (header e estrutura principal mantidos iguais) ... -->

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Elementos da interface
            const btnExportar = document.getElementById('btnExportar');
            const btnEditar = document.getElementById('btnEditar');
            const tabela = document.querySelector('.tabela tbody');
            const modalEdicao = document.getElementById('modal-edicao');
            const formEdicao = document.getElementById('form-edicao');
            const cancelarEdicao = document.getElementById('cancelar-edicao');
            const alerta = document.getElementById('alerta');

            let linhaSelecionada = null;

            // Carregar dados
            const dados = JSON.parse(localStorage.getItem('tabelaBackup')) || [];
            dados.forEach(row => {
                const novaLinha = tabela.insertRow();
                for (let i = 0; i < 8; i++) {
                    const celula = novaLinha.insertCell();
                    celula.innerText = row[i] || '';
                }
                
                // Adiciona evento de clique diretamente na linha
                novaLinha.addEventListener('click', function() {
                    // Remove seleção anterior
                    if (linhaSelecionada) {
                        linhaSelecionada.classList.remove('selecionada');
                    }
                    
                    // Adiciona seleção nova
                    this.classList.add('selecionada');
                    linhaSelecionada = this;
                    
                    // Atualiza o botão de edição
                    btnEditar.disabled = false;
                });
            });

            // Desabilita o botão de edição inicialmente
            btnEditar.disabled = true;

            // Exportar para Excel
            btnExportar.addEventListener('click', () => {
                const tabelaDOM = document.querySelector('.tabela');
                const wb = XLSX.utils.table_to_book(tabelaDOM, { sheet: "Ocorrencias" });
                XLSX.writeFile(wb, 'ocorrencias.xlsx');
            });

            // Botão Editar
            btnEditar.addEventListener('click', () => {
                if (!linhaSelecionada) {
                    mostrarAlerta('⚠️ Selecione uma linha para editar');
                    return;
                }
                
                // Preencher modal com dados da linha
                document.getElementById('editar-atendente').value = linhaSelecionada.cells[0].innerText;
                document.getElementById('editar-movel').value = linhaSelecionada.cells[1].innerText;
                document.getElementById('editar-destinos').value = linhaSelecionada.cells[2].innerText;
                document.getElementById('editar-kmSaida').value = linhaSelecionada.cells[3].innerText;
                document.getElementById('editar-kmChegada').value = linhaSelecionada.cells[5].innerText;
                document.getElementById('editar-obs').value = linhaSelecionada.cells[7].innerText;
                
                modalEdicao.style.display = 'flex';
            });

            // ... (restante do código mantido igual) ...
        });
    </script>
</body>
</html>